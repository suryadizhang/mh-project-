# ==========================================
# Backend Environment Variables
# ==========================================
# Copy this file to .env and fill in the values
# NEVER commit the .env file to version control!

# ==========================================
# Database Configuration (REQUIRED)
# ==========================================
# PostgreSQL connection string - must start with postgresql:// or postgresql+asyncpg://
# Format: postgresql+asyncpg://user:password@host:port/database
#
# PRODUCTION: Plesk VPS PostgreSQL (myhibachi_prod database)
# Replace with actual Plesk database credentials
DATABASE_URL=postgresql+asyncpg://myhibachi_user:password@localhost:5432/myhibachi_prod

# Supabase Test Database (TESTING/DEVELOPMENT ONLY - NOT FOR PRODUCTION)
# This is only for local development and testing scripts
# Format: postgresql://user:password@host:port/database
SUPABASE_DB_URL=postgresql://postgres:your-password@db.yuchqvpctookhjovvdwi.supabase.co:5432/postgres

# Database Connection Pool Settings
DB_POOL_SIZE=10           # Number of connections in pool
DB_MAX_OVERFLOW=20        # Additional connections if pool exhausted
DB_ECHO=False             # Set to True for SQL query logging (development only)

# ==========================================
# Redis Configuration (REQUIRED)
# ==========================================
# Redis connection string - must start with redis://
# Format: redis://host:port/db
# Development example:
REDIS_URL=redis://localhost:6379/0

# Celery Broker (usually same as REDIS_URL)
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# ==========================================
# Celery Flower Monitoring (Admin UI)
# ==========================================
# Web dashboard at http://localhost:5555 to monitor background tasks
# Credentials for accessing Flower admin interface
FLOWER_ADMIN_USERNAME=admin
FLOWER_ADMIN_PASSWORD=change-this-secure-password-123
FLOWER_PORT=5555

# ==========================================
# Call Recording Storage (VPS Filesystem)
# ==========================================
# Local filesystem path for storing call recordings (NOT S3)
# Path must exist and be writable by the application
# Will create subdirectories: /YYYY/MM/ for organization
RECORDINGS_STORAGE_PATH=/var/www/vhosts/myhibachi/recordings

# Call recording retention policy (days)
# Recordings older than this will be auto-deleted by cleanup worker
RECORDING_RETENTION_DAYS=90

# Recording archive threshold (days)
# Recordings older than this will be moved to archive subdirectory
RECORDING_ARCHIVE_DAYS=30

# ==========================================
# Security Keys (REQUIRED - CRITICAL)
# ==========================================
# WARNING: These MUST be at least 32 characters for cryptographic security!
# Generate with: openssl rand -hex 32

# Secret key for JWT tokens and general security
# Min 32 characters - will fail validation if shorter
SECRET_KEY=your-secret-key-min-32-chars-CHANGE-IN-PRODUCTION-1234567890

# Encryption key for sensitive data in database
# Min 32 characters - will fail validation if shorter
ENCRYPTION_KEY=your-encryption-key-min-32-chars-CHANGE-IN-PRODUCTION-1234567890

# JWT token expiration (minutes)
ACCESS_TOKEN_EXPIRE_MINUTES=30

# ==========================================
# Stripe Payment Integration (REQUIRED)
# ==========================================
# Get from: https://dashboard.stripe.com/apikeys

# Secret key - must start with sk_test_ (dev) or sk_live_ (production)
# REPLACE WITH YOUR ACTUAL KEY - This is just a placeholder format example
STRIPE_SECRET_KEY=sk_test_YOUR_STRIPE_SECRET_KEY_GOES_HERE_REPLACE_THIS

# Publishable key - must start with pk_test_ or pk_live_
STRIPE_PUBLISHABLE_KEY=pk_test_YOUR_STRIPE_PUBLISHABLE_KEY_HERE

# Webhook secret - must start with whsec_
# Get from: https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET=whsec_YOUR_WEBHOOK_SECRET_HERE_REPLACE_THIS

# ==========================================
# RingCentral SMS/Phone Integration (REQUIRED)
# ==========================================
# Get from: https://developers.ringcentral.com/my-account.html
RC_CLIENT_ID=your-ringcentral-client-id
RC_CLIENT_SECRET=your-ringcentral-client-secret
RC_JWT_TOKEN=your-ringcentral-jwt-token
RC_WEBHOOK_SECRET=your-ringcentral-webhook-secret
RC_SMS_FROM=+1XXXXXXXXXX
RC_SERVER_URL=https://platform.ringcentral.com

# ==========================================
# Meta WhatsApp Business API (REQUIRED FOR WHATSAPP)
# ==========================================
# Get from: https://developers.facebook.com/apps/
# Complete Meta Business Verification first!
# ALL SECRETS MANAGED VIA GOOGLE SECRET MANAGER (GSM)
META_APP_ID=your-meta-app-id
META_APP_SECRET=gsm://my-hibachi-crm/META_APP_SECRET
META_PAGE_ACCESS_TOKEN=gsm://my-hibachi-crm/META_PAGE_ACCESS_TOKEN
META_PHONE_NUMBER_ID=your-phone-number-id
META_WHATSAPP_BUSINESS_ACCOUNT_ID=your-whatsapp-business-account-id
META_VERIFY_TOKEN=gsm://my-hibachi-crm/META_VERIFY_TOKEN

# ==========================================
# Admin Notification Settings
# ==========================================
# On-call admin phone for urgent notifications (escalations, etc.)
# If not set, falls back to BUSINESS_PHONE
ON_CALL_ADMIN_PHONE=+19167408768

# ==========================================
# OpenAI API (REQUIRED FOR AI FEATURES)
# ==========================================
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-XXXXXXXXXXXXXXXXXXXXXXXX
OPENAI_MODEL=gpt-4
OPENAI_REALTIME_MODEL=gpt-4o-realtime-preview-2024-12-17

# ==========================================
# Deepgram Speech AI (REQUIRED FOR VOICE AI)
# ==========================================
# Get from: https://console.deepgram.com/
# Provides both Speech-to-Text (STT) and Text-to-Speech (TTS)
# Pricing: $0.0125/min STT, $0.015/1000 chars TTS
DEEPGRAM_API_KEY=your-deepgram-api-key-here
DEEPGRAM_MODEL=nova-2                      # Options: nova-2 | nova | enhanced
DEEPGRAM_TTS_MODEL=aura-asteria-en        # Natural female voice
ENABLE_VOICE_AI=true                       # Enable voice AI features

# Real-time Voice AI Configuration (WebRTC)
VOICE_WEBSOCKET_TIMEOUT=30                 # WebSocket timeout (seconds)
VOICE_AUDIO_SAMPLE_RATE=16000              # Target audio sample rate (Hz)
VOICE_SILENCE_THRESHOLD=0.01               # Silence detection threshold (RMS)
VOICE_MAX_ERRORS=10                        # Max errors before call termination

# ==========================================
# Plaid Banking Integration (OPTIONAL)
# ==========================================
# Get from: https://dashboard.plaid.com/team/keys
PLAID_CLIENT_ID=your-plaid-client-id
PLAID_SECRET=your-plaid-secret
PLAID_ENV=sandbox  # Options: sandbox | development | production

# ==========================================
# Google Business Integration (OPTIONAL)
# ==========================================
# Get from: https://console.cloud.google.com/
GOOGLE_CLOUD_PROJECT=your-google-cloud-project
GOOGLE_CREDENTIALS_JSON=/path/to/credentials.json
GBP_ACCOUNT_ID=your-google-business-account-id
GBP_LOCATION_ID=your-google-business-location-id

# Google Maps API (REQUIRED FOR TRAVEL FEE CALCULATION)
# Get from: https://console.cloud.google.com/google/maps-apis/
# Required APIs to enable:
#   1. Distance Matrix API (for travel distance calculation)
#   2. Places API (for address validation)
#   3. Maps JavaScript API (for frontend autocomplete)
# After creating key, restrict it to your domain for security
GOOGLE_MAPS_API_KEY=your-google-maps-api-key-here

# ==========================================
# Email Settings (IONOS Business Email)
# ==========================================
EMAIL_ENABLED=True
EMAIL_PROVIDER=smtp
SMTP_HOST=smtp.ionos.com
SMTP_PORT=587
SMTP_USER=your_email@yourdomain.com
SMTP_PASSWORD=your_password_here
SMTP_USE_TLS=True
FROM_EMAIL=your_email@yourdomain.com
EMAILS_FROM_NAME="My Hibachi Chef"
EMAIL_TIMEOUT=30

# ==========================================
# Gmail Integration (Payment Notifications)
# ==========================================
# Gmail account for receiving payment notifications
# Get App Password from: https://myaccount.google.com/apppasswords
# Note: Requires 2FA enabled on Gmail account
GMAIL_USER=myhibachichef@gmail.com
GMAIL_APP_PASSWORD=your-16-char-app-password-here

# Payment email monitoring settings
PAYMENT_EMAIL_CHECK_INTERVAL_MINUTES=5  # Check every 5 minutes
PAYMENT_EMAIL_LOOKBACK_DAYS=7           # Process emails from last 7 days

# Customer Review System
CUSTOMER_APP_URL=https://myhibachi.com
YELP_REVIEW_URL=https://www.yelp.com/biz/my-hibachi-chef-your-city
GOOGLE_REVIEW_URL=https://g.page/r/YOUR_GOOGLE_PLACE_ID/review

# Review Coupon Settings
REVIEW_COUPON_DISCOUNT_PERCENTAGE=10
REVIEW_COUPON_VALIDITY_DAYS=90
REVIEW_COUPON_MINIMUM_ORDER_CENTS=5000

# ==========================================
# Application Settings
# ==========================================
APP_NAME=My Hibachi Chef CRM
DEBUG=False             # Set to True for development debugging
ENVIRONMENT=production  # Options: development | staging | production
API_VERSION=1.0.0

# Server Configuration
HOST=0.0.0.0
PORT=8000

# CORS Origins (comma-separated)
CORS_ORIGINS=https://myhibachichef.com,https://admin.mysticdatanode.net

# ==========================================
# Cloudflare Configuration (REQUIRED FOR PRODUCTION)
# ==========================================
# Get Zone ID from: Cloudflare Dashboard → mysticdatanode.net → Overview (bottom right)
# Get API Token from: Profile → API Tokens → Create Custom Token (Zone WAF Edit)
CLOUDFLARE_ZONE_ID=your-cloudflare-zone-id-here
CLOUDFLARE_WAF_API_TOKEN=your-cloudflare-waf-api-token-here
CLOUDFLARE_TUNNEL_TOKEN=your-cloudflare-tunnel-token-here

# ==========================================
# Sentry Error Tracking & Monitoring (RECOMMENDED)
# ==========================================
# Get from: https://sentry.io/organizations/your-org/projects/
# Create project → Copy DSN
SENTRY_DSN=https://your-sentry-dsn-here@sentry.io/your-project-id
SENTRY_ENVIRONMENT=production  # Optional: defaults to ENVIRONMENT value
SENTRY_TRACES_SAMPLE_RATE=0.1  # 10% of transactions (adjust for production load)
SENTRY_PROFILES_SAMPLE_RATE=0.1  # 10% profiling (performance monitoring)

# ==========================================
# Business Information (PUBLIC DATA ONLY)
# ==========================================
BUSINESS_NAME=my Hibachi LLC
BUSINESS_EMAIL=cs@myhibachichef.com
BUSINESS_PHONE=+19167408768
BUSINESS_ADDRESS=47481 Towhee St
BUSINESS_CITY=Fremont
BUSINESS_STATE=California
BUSINESS_ZIP=94539
SERVICE_AREAS=Sacramento, Bay Area, Central Valley

# ==========================================
# AI Settings
# ==========================================
ENABLE_AI_AUTO_REPLY=True
AI_CONFIDENCE_THRESHOLD=80

# ==========================================
# Business Rules
# ==========================================
QUIET_HOURS_START=21      # 9 PM
QUIET_HOURS_END=8         # 8 AM
DEFAULT_TIMEZONE=America/Los_Angeles
MAX_SMS_PER_THREAD=3

# ==========================================
# Rate Limiting Configuration
# ==========================================
# Public API (unauthenticated)
RATE_LIMIT_PUBLIC_PER_MINUTE=20
RATE_LIMIT_PUBLIC_PER_HOUR=1000
RATE_LIMIT_PUBLIC_BURST=30

# Admin API (authenticated admin users)
RATE_LIMIT_ADMIN_PER_MINUTE=100
RATE_LIMIT_ADMIN_PER_HOUR=5000
RATE_LIMIT_ADMIN_BURST=150

# Super Admin (owner/manager)
RATE_LIMIT_ADMIN_SUPER_PER_MINUTE=200
RATE_LIMIT_ADMIN_SUPER_PER_HOUR=10000
RATE_LIMIT_ADMIN_SUPER_BURST=300

# AI Endpoints (cost-controlled)
RATE_LIMIT_AI_PER_MINUTE=10
RATE_LIMIT_AI_PER_HOUR=300
RATE_LIMIT_AI_BURST=15

# Webhooks (external services)
RATE_LIMIT_WEBHOOK_PER_MINUTE=100
RATE_LIMIT_WEBHOOK_PER_HOUR=5000
RATE_LIMIT_WEBHOOK_BURST=200
