# MyHibachi Backend Upstream Configuration
# Location: /etc/nginx/conf.d/myhibachi-upstream.conf
# 
# This file defines the backend server pool for load balancing.
# Copy this file to /etc/nginx/conf.d/ on your Plesk VPS.

upstream myhibachi_backend {
    # Load balancing method
    # Options: round_robin (default), least_conn, ip_hash
    least_conn;  # Route to backend with fewest active connections
    
    # Backend instances
    # Format: server <ip>:<port> [parameters];
    server 127.0.0.1:8001 max_fails=2 fail_timeout=30s weight=3;  # Primary
    server 127.0.0.1:8002 max_fails=2 fail_timeout=30s weight=2 backup;  # Backup 1
    server 127.0.0.1:8003 max_fails=2 fail_timeout=30s weight=1 backup;  # Backup 2
    
    # Keepalive connections for better performance
    keepalive 32;  # Max idle keepalive connections to upstreams
    keepalive_requests 100;  # Max requests per keepalive connection
    keepalive_timeout 60s;  # Timeout for keepalive connections
}

# Active health check (requires nginx_upstream_check_module or nginx-plus)
# If you have the module compiled, uncomment these lines:
# 
# check interval=30000 rise=2 fall=3 timeout=10000 type=http;
# check_http_send "GET /health HTTP/1.0\r\n\r\n";
# check_http_expect_alive http_2xx;
# 
# Otherwise, Nginx uses passive health checks via max_fails parameter above.
